--- poppler-0.20.0/poppler/Stream.cc.cve-2009-3608,3609.patch	2012-05-03 23:28:57.000000000 +0200
+++ poppler-0.20.0/poppler/Stream.cc	2012-05-14 16:15:23.957354840 +0200
@@ -426,7 +426,10 @@ ImageStream::ImageStream(Stream *strA, i
   if (nBits == 8) {
     imgLine = (Guchar *)inputLine;
   } else {
-    if (nBits == 1) {
+    if (nComps <= 0 || width <= 0 || nVals <= 0 || width != nVals / nComps)
+      // force a call to gmallocn(-1,...), which will throw an exception
+      imgLineSize = -1;
+    else if (nBits == 1) {
       imgLineSize = (nVals + 7) & ~7;
     } else {
       imgLineSize = nVals;
